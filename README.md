# Essentials

A pilates and fitness app built with Next.js, Drizzle ORM, and Supabase.

## Database Management

This project uses Drizzle ORM with PostgreSQL (Supabase) and supports separate development and production environments.

### Environment Setup

Create two environment files:

**`.env.local` (Development):**

```bash
# Development Database
DATABASE_URL="your-dev-supabase-database-url"
NEXT_PUBLIC_SUPABASE_URL="your-dev-supabase-url"
NEXT_PUBLIC_SUPABASE_ANON_KEY="your-dev-anon-key"
SUPABASE_SERVICE_ROLE_KEY="your-dev-service-role-key"

# Development Settings
NEXT_PUBLIC_USER_ROLE="DEVELOPER"
NODE_ENV="development"

# API Keys
RESEND_API_KEY="your-resend-api-key"
OPENAI_API_KEY="your-openai-api-key"
WEBHOOK_API_KEY="your-webhook-api-key"
```

**`.env.prod` (Production):**

```bash
# Production Database
DATABASE_URL="your-prod-supabase-database-url"
NEXT_PUBLIC_SUPABASE_URL="your-prod-supabase-url"
NEXT_PUBLIC_SUPABASE_ANON_KEY="your-prod-anon-key"
SUPABASE_SERVICE_ROLE_KEY="your-prod-service-role-key"

# Production Settings
NODE_ENV="production"

# API Keys
RESEND_API_KEY="your-resend-api-key"
OPENAI_API_KEY="your-openai-api-key"
WEBHOOK_API_KEY="your-webhook-api-key"
```

### Database Commands

#### Development Commands (uses .env.local)

```bash
# Generate migrations from schema changes
npm run db:generate

# Apply migrations to development database
npm run db:migrate

# Push schema directly to development (bypass migrations)
npm run db:push

# Open Drizzle Studio for development database
npm run db:studio
```

#### Production Commands (uses .env.prod)

```bash
# Apply migrations to production database (with safety prompt)
npm run db:migrate:prod

# Push schema directly to production (with safety prompt)
npm run db:push:prod

# Open Drizzle Studio for production database
npm run db:studio:prod
```

### Development â†’ Production Workflow

#### 1. Make Schema Changes

```bash
# 1. Edit schema files in src/drizzle/src/db/schema.ts
# 2. Generate migration
npm run db:generate

# 3. Apply to development database
npm run db:migrate

# 4. Test thoroughly
npm run dev
```

#### 2. Deploy to Production

```bash
# 1. Commit and push changes
git add .
git commit -m "feat: add new schema feature"
git push

# 2. Apply to production (prompts for confirmation)
npm run db:migrate:prod
# Type "YES" when prompted to confirm
```

#### 3. Keeping Databases in Sync

```bash
# Check if databases are in sync
npm run db:generate
# Should show: "No schema changes, nothing to migrate ðŸ˜´"

# If schemas diverge, force sync dev to match current schema
npm run db:push

# Or force sync prod to match current schema (be careful!)
npm run db:push:prod
```

## Project Architecture

### AI Integration Notes

- The shape of the data is defined in the schema at src/drizzle/src/db/schema.ts
- Each workout_plan has a weekly_schedule - each weekly_schedule entry is a single workout for a single week per workout_plan:
  ```
  weekly_schedule: {
    id: UUID,
    plan_id: UUID fk to workout_plan.id
    week_number: INT
    workout_Id: UUID fk to workout.id
  }
  ```
- When creating a new workout plan, data will need to be entered into workout_plan, weekly_schedule and workout
- A planName should also be generated by the AI - we could default to the date started or something
